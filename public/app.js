"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){t.module("webtrekk",["ui.router"]).config(["$urlServiceProvider","$locationProvider",function(t,e){"ngInject";e.html5Mode(!0)}])}(angular),function(t){function e(t,e,r,n){"ngInject";var s=this;(function(){t.load(),this.user=t.byId[e.customerId]||new n}).call(this),this.save=function(){if(!s.user.isValid())return alert("please complete information");"0"==s.user.customer_id?t.create(s.user):t.save(),r.go("customerlist")}}e.$inject=["UsersData","$stateParams","$state","CustomerClass"],t.module("webtrekk").controller("detailsController",e)}(angular),function(t){function e(t,e){"ngInject";t.state("customerDetails",{url:"/data/{customerId:[0-9]{1,8}}",template:"<details></details>"})}e.$inject=["$stateProvider","$urlServiceProvider"],t.module("webtrekk").config(e).directive("details",function(){return{templateUrl:"/details/details.html",scope:{},replace:!0,controllerAs:"$ctrl",controller:"detailsController"}})}(angular),angular.module("webtrekk").filter("ageFilter",function(){function t(t){if(!t)return"N/A";t.getTime||(t=new Date(t));var e=Date.now()-t.getTime(),r=new Date(e);return Math.abs(r.getUTCFullYear()-1970)}return function(e){return t(e)}}),angular.module("webtrekk").filter("genderFilter",function(){function t(t){if(!t)return"N/A";var e=String(t).toLowerCase();switch(["m","w"].indexOf(e)){case 0:return"Male";case 1:return"Female";default:return"N/A"}}return function(e){return t(e)}}),function(t){function e(t,e){"ngInject";e.rules.otherwise({state:"customerlist"}),t.state("customerlist",{url:"/",template:"<main></main>"})}e.$inject=["$stateProvider","$urlServiceProvider"],t.module("webtrekk").config(e).directive("main",function(){return{templateUrl:"/main/main.html",scope:{},replace:!0,controllerAs:"$ctrl",controller:"mainController"}})}(angular),function(t){function e(t,e,r){"ngInject";this.orderBy="last_name",this.reverseSort=!1,this.read=function(e,r){return t.byId[e][r]||"N/A"},this.remove=function(e){t.remove(e),this.users=t.ids}.bind(this),this.sort=function(e){this.orderBy!==e?(this.orderBy=e,this.reverseSort=!1):this.reverseSort=!this.reverseSort;var r=this.reverseSort?"-":"";this.users=t.sortBy(r+this.orderBy)}.bind(this),function(){var e=this;r.$watch(function(){return t.ids},function(t){e.users=t});t.load(),t.sortBy("last_name")}.call(this)}e.$inject=["UsersData","$timeout","$scope"],t.module("webtrekk").controller("mainController",e)}(angular),function(t){function e(t,e){"ngInject";t.state("navi",{url:"/navi/{customerId:[0-9]{1,8}}",template:"<navi></navi>"})}e.$inject=["$stateProvider","$urlServiceProvider"],t.module("webtrekk").config(e).directive("navi",function(){return{templateUrl:"/navi/navi.html",scope:{},replace:!0,controllerAs:"$ctrl",controller:"navHistoryController"}})}(angular),function(){function t(t,e){"ngInject";(function(){t.load(),this.user=t.byId[e.customerId]||{},this.history=t.naviById[e.customerId]}).call(this)}t.$inject=["UsersData","$stateParams"],angular.module("webtrekk").controller("navHistoryController",t)}(angular),function(t){function e(t,e,r){"ngInject";return{get:function(){try{var n=JSON.parse(e.getItem(r));if(!n||(void 0===n?"undefined":_typeof(n))!==(void 0===t?"undefined":_typeof(t)))throw"no intialdata";return this._error=null,n}catch(e){return this._error?(this._error=null,console.warn("it looks like StorageEngine has failed... returning vanilla JS"),t):(this.set.call(this,t),this._error=e,this.get())}},set:function(t){e.setItem(r,JSON.stringify(t))},reload:function(){return this.set(t),this.get()}}}e.$inject=["initialState","StorageEngine","STORAGE_ID"],t.module("webtrekk").constant("StorageEngine",localStorage).constant("STORAGE_ID","webtrekk__local").constant("initialState",{master:[{customer_id:"1",first_name:"Peter",last_name:"Smith",birthday:"1996-10-12",gender:"m",last_contact:"2013-06-01",customer_lifetime_value:"191,12"},{customer_id:"2",first_name:"Anna",last_name:"Hopp",birthday:"1987-05-03",gender:"w",last_contact:"2013-07-08",customer_lifetime_value:"50,99"},{customer_id:"3",first_name:"Christian",last_name:"Cox",birthday:"1991-02-21",gender:"m",last_contact:"2013-08-01",customer_lifetime_value:"0"},{customer_id:"4",first_name:"Roxy",last_name:"Fox",birthday:"1979-06-30",gender:"w",last_contact:"2012-01-29",customer_lifetime_value:"213,12"},{customer_id:"5",first_name:"Eric",last_name:"Adam",birthday:"1969-11-21",gender:"m",last_contact:"2013-03-18",customer_lifetime_value:"1019,91"}],navi:[{customer_id:"1",pages:"A",timestamp:"2013-06-01 10:10:12"},{customer_id:"1",pages:"B",timestamp:"2013-06-01 10:11:12"},{customer_id:"1",pages:"A",timestamp:"2013-06-01 10:12:12"},{customer_id:"2",pages:"C",timestamp:"2013-07-08 09:03:09"},{customer_id:"2",pages:"A",timestamp:"2013-07-08 09:09:09"},{customer_id:"2",pages:"D",timestamp:"2013-07-08 09:19:09"},{customer_id:"3",pages:"B",timestamp:"2013-07-08 09:19:09"},{customer_id:"3",pages:"A",timestamp:"2013-07-08 09:19:10"},{customer_id:"4",pages:"D",timestamp:"2013-07-08 09:19:11"},{customer_id:"4",pages:"A",timestamp:"2013-07-08 09:19:12"},{customer_id:"5",pages:"X",timestamp:"2013-07-08 09:19:13"},{customer_id:"5",pages:"A",timestamp:"2013-07-08 09:19:14"},{customer_id:"5",pages:"B",timestamp:"2013-07-08 09:19:15"}]}).factory("$wt_storage",e)}(angular),function(){angular.module("webtrekk").factory("CustomerClass",function(){return t});var t=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t),this.customer_id=this._id=String(e.customer_id||"0"),this.first_name=String(e.first_name||""),this.last_name=String(e.last_name||""),this.birthday=new Date(e.birthday),this.gender=String(e.gender).toLowerCase(),this.last_contact=new Date(e.last_contact),this.customer_lifetime_value=String(e.customer_lifetime_value||""),this.isValid=this.isValid.bind(this)}return _createClass(t,[{key:"isValid",value:function(){return 0===[-1===["m","w"].indexOf(this.gender),isNaN(Date.parse(this.birthday)),isNaN(Date.parse(this.last_contact))].filter(Boolean).length}}]),t}()}(),function(t){function e(t,e){"ngInject";function r(){var e=t.get();return this.byId=e.master.reduce(a,{}),this.naviById=e.navi.reduce(i,{}),this.ids=Object.keys(this.byId),this}function n(t,e){var r=1;return"-"===t[0]&&(r=-1,t=t.substr(1)),function(n,s){if(e){var a=e[n],i=e[s];return(a[t]<i[t]?-1:a[t]>i[t]?1:0)*r}return(n[t]<s[t]?-1:n[t]>s[t]?1:0)*r}}var s=this;this.load=r.bind(this),this.byId={},this.naviById={},this.ids=[],this.sortBy=function(t){return this.ids=this.ids.sort(n(t,this.byId)),this.ids}.bind(this),this.save=function(){var e={master:Object.values(this.byId),navi:Object.values(this.naviById).reduce(function(t,e){return t.concat(e)},[])};return t.set(e),this}.bind(this),this.remove=function(e){var n={master:Object.values(this.byId).filter(function(t){return t.customer_id!==e}),navi:Object.values(this.naviById).reduce(function(t,e){return t.concat(e)},[]).filter(function(t){return t.customer_id!==e})};t.set(n),r.call(this)}.bind(this),this.create=function(t){var r=new e(t);return r.customer_id=r._findNextId(this.ids),this.byId[r.customer_id]=r,this.naviById[r.customer_id]=[],this.ids.push(r.customer_id),this.save()}.bind(this),this.getNavigation=function(t){return s.naviById[t]},this._dynamicSort=n;var a=function(t,r){return t[r.customer_id]=new e(r),t},i=function(t,e){return e.timestamp=new Date(e.timestamp),t[e.customer_id]?t[e.customer_id].push(e):t[e.customer_id]=[e],t}}e.$inject=["$wt_storage","CustomerClass"],t.module("webtrekk").factory("CustomerClass",function(){return r}).service("UsersData",e);var r=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t),this.customer_id=this._id=String(e.customer_id||"0"),this.first_name=String(e.first_name||""),this.last_name=String(e.last_name||""),this.birthday=new Date(e.birthday),this.gender=String(e.gender).toLowerCase(),this.last_contact=new Date(e.last_contact),this.customer_lifetime_value=String(e.customer_lifetime_value||""),this.isValid=this.isValid.bind(this)}return _createClass(t,[{key:"isValid",value:function(){return 0===[-1===["m","w"].indexOf(this.gender),isNaN(Date.parse(this.birthday)),isNaN(Date.parse(this.last_contact))].filter(Boolean).length}},{key:"_findNextId",value:function(t){for(var e=0,r=Array.from(t).map(Number).sort(),n=r[0]+1;-1!==r.indexOf(n)&&e<100;)n+=1,e++;return String(n)}}]),t}()}(angular),function(t){t.module("webtrekk").run(["$templateCache",function(t){t.put("/navi/navi.html",'<div class="has__form">\n <h1 ng-if="$ctrl.user.customer_id">{{$ctrl.user.first_name}} {{$ctrl.user.last_name}} Navigation history</h1>\n <h1 ng-if="!$ctrl.user.customer_id">no valid user id provided</h1>\n\n <table ng-init="$reverseSort=false;$attr=\'pages\'" id="main_overview_table" class="table table-sm table-hover table-striped table-bordered" style="margin:20px auto">\n <caption style="caption-side:top;">\n <h1>Customer Overview</h1>\n <a ui-sref="customerlist()" class="btn btn-primary">\n back\n <span class="badge badge-secondary">{{$ctrl.count}}+</span>\n </a>\n </caption>\n <thead class="thead-inverse">\n <tr>\n <th>\n <a style="color:white" href="#" ng-click="$attr=\'pages\';$reverseSort=!$reverseSort">\n Pages\n <span ng-show="$attr == \'pages\'">\n <span ng-show="!$reverseSort">^</span>\n <span ng-show="$reverseSort">v</span>\n </span>\n </a>\n </th>\n <th>\n <a style="color:white" href="#" ng-click="$attr=\'timestamp\';$reverseSort=!$reverseSort">\n Time stamp\n <span ng-show="$attr == \'timestamp\'">\n <span ng-show="!$reverseSort">^</span>\n <span ng-show="$reverseSort">v</span>\n </span>\n </a>\n </th>\n </tr>\n </thead>\n <tbody>\n <tr ng-repeat="entry in $ctrl.history|orderBy:$attr:$reverseSort">\n <th>{{entry.pages}}</th>\n <th>{{entry.timestamp}}</th>\n </tr>\n </tbody>\n </table>\n\n</div>'),t.put("/main/main.html",'<table id="main_overview_table" class="table table-sm table-hover table-striped table-bordered" style="margin:20px auto">\n <caption style="caption-side:top;">\n <h1>Customer Overview</h1>\n <a ui-sref="customerDetails({customerId: 0})" class="btn btn-primary">\n Create new customer\n <span class="badge badge-secondary">{{$ctrl.count}}+</span>\n </button>\n </caption>\n <thead class="thead-inverse">\n <tr>\n <th>\n <a style="color:white" href="#" ng-click="$ctrl.sort(\'first_name\')" >\n First Name\n <span ng-show="$ctrl.orderBy == \'first_name\'">\n <span ng-show="!$ctrl.reverseSort">^</span>\n <span ng-show="$ctrl.reverseSort">v</span>\n </span>\n </a>\n </th>\n <th>\n <a style="color:white" href="#" ng-click="$ctrl.sort(\'last_name\')">\n Last Name\n <span ng-show="$ctrl.orderBy == \'last_name\'">\n <span ng-show="!$ctrl.reverseSort">^</span>\n <span ng-show="$ctrl.reverseSort">v</span>\n </span>\n </a>\n </th>\n <th>\n <a style="color:white" href="#" ng-click="$ctrl.sort(\'birthday\')" >\n Age\n <span ng-show="$ctrl.orderBy == \'birthday\'">\n <span ng-show="!$ctrl.reverseSort">^</span>\n <span ng-show="$ctrl.reverseSort">v</span>\n </span>\n </a>\n </th>\n <th>\n <a style="color:white" href="#" ng-click="$ctrl.sort(\'gender\')" >\n Gender\n <span ng-show="$ctrl.orderBy == \'gender\'">\n <span ng-show="!$ctrl.reverseSort">^</span>\n <span ng-show="$ctrl.reverseSort">v</span>\n </span>\n </a>\n </th>\n <th>options</th>\n </tr>\n </thead>\n <tr ng-repeat="id in $ctrl.users" ng-class="{{$ctrl.UsersData.byId[id].isValid() ? \'ok\' : \'table-danger\'}}">\n <td> {{::$ctrl.read(id,\'first_name\')}} </td>\n <td> {{::$ctrl.read(id,\'last_name\')}} </td>\n <td> {{::$ctrl.read(id,\'birthday\')|ageFilter}} </td>\n <td> {{::$ctrl.read(id,\'gender\')|genderFilter}} </td>\n <td>\n <div class="flex__row">\n <a ui-sref="customerDetails({customerId: id})" class="btn btn-primary">\n Edit\n </a>\n <button class="btn btn-danger" ng-click="$ctrl.remove(id)">\n Delete\n </button>\n <a ui-sref="navi({customerId: id})" class="btn btn-success">\n Navi\n </a>\n </div>\n </td>\n </tr>\n</table>'),t.put("/details/details.html",'<div class="has__form">\n <h1 ng-if="$ctrl.user._id != \'0\'">{{$ctrl.user.first_name}} {{$ctrl.user.last_name}} Details</h1>\n <h1 ng-if="$ctrl.user._id == \'0\'">Create New user</h1>\n\n <form>\n <div class="form-group" ng-if="$ctrl.user._id != \'0\'">\n <label for="customer_id">customer id</label>\n <input type="number" class="form-control" id="customer_id" disabled ng-value="{{$ctrl.user.customer_id/1}}" placeholder="customer_id">\n <small ng-if="$ctrl.errors.customer_id" id="customer_idHelp" class="form-text text-danger">{{$ctrl.errors.customer_id}}</small>\n </div>\n\n <div class="form-group">\n <label for="first_name">first name*</label>\n <input type="string" class="form-control" id="first_name" ng-model="$ctrl.user.first_name" placeholder="first_name">\n <small ng-if="$ctrl.errors.first_name" id="first_nameHelp" class="form-text text-danger">{{$ctrl.errors.first_name}}</small>\n </div>\n \n <div class="form-group">\n <label for="last_name">last name*</label>\n <input type="string" class="form-control" id="last_name" ng-model="$ctrl.user.last_name" placeholder="last_name">\n <small ng-if="$ctrl.errors.last_name" id="last_nameHelp" class="form-text text-danger">{{$ctrl.errors.last_name}}</small>\n </div>\n\n <div class="form-group">\n <label for="birthday">birthday*</label>\n <input\n placeholder="yyyy-MM-dd"\n min="1970-01-01" max="2017-12-22" required type="date" class="form-control" id="birthday" ng-model="$ctrl.user.birthday" placeholder="birthday">\n <small ng-if="$ctrl.errors.birthday" id="birthdayHelp" class="form-text text-danger">{{$ctrl.errors.birthday}}</small>\n </div>\n \n <div class="form-group">\n <label for="gender">gender*</label>\n <select name="gender" class="form-control" ng-model="$ctrl.user.gender">\n <option value="m">Male</option>\n <option value="w">Female</option>\n </select>\n </div>\n \n <div class="form-group">\n <label for="last_contact">last contact*</label>\n <input ng-disabled="!$ctrl.user.customer_id" type="date" class="form-control" id="last_contact" ng-model="$ctrl.user.last_contact" placeholder="last_contact">\n <small ng-if="$ctrl.errors.last_contact" id="last_contactHelp" class="form-text text-danger">{{$ctrl.errors.last_contact}}</small>\n </div>\n \n <div class="form-group">\n <label for="customer_lifetime_value">customer lifetime_value</label>\n <input type="string" class="form-control" id="customer_lifetime_value" ng-model="$ctrl.user.customer_lifetime_value" placeholder="customer_lifetime_value">\n <small ng-if="$ctrl.errors.customer_lifetime_value" id="customer_lifetime_valueHelp" class="form-text text-danger">{{$ctrl.errors.customer_lifetime_value}}</small>\n </div>\n\n <hr/>\n <div style="min-width:100%">\n <button ng-disabled="!$ctrl.user.isValid()" class="btn btn-primary" ng-click="$ctrl.save()">\n save and go back\n </button>\n <button ui-sref="customerlist()" class="btn btn-dark">\n cancel\n </button>\n </div>\n\n </form>\n</div>')}])}(angular);