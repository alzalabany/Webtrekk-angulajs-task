'use strict';

/*
  Main Module Definition.
  - We will be using RoC reverse control pattern for better flexisblity
  - The main module is UN-AWARE of any of its dependinces except of 3rd party

  *Rules

  - DO NOT EDIT THIS FILE UNLESS ALL TEAM AGREE THAT ADDING A NEW 3rd PARTY
    DEPENDENCY TO APP IS OKAY BY EVERY ONE
  - All Modules should inherit from this main module
  - All Modules should declare its own Config and Run code blocks,
    Angular will take care of running them all.
  - Keep this module Clean, only Global Configurtion should be set here
*/
(function (angular) {
  'use strict';

  angular.module('webtrekk', ['ui.router']).config(["$urlServiceProvider", "$locationProvider", function ($urlServiceProvider, $locationProvider) {
    "ngInject";

    $locationProvider.html5Mode(true);
  }]);
})(angular);

(function (angular) {
  'use strict';

  config.$inject = ["$stateProvider", "$urlServiceProvider"];
  controller.$inject = ["usersStore"];
  angular.module('webtrekk').config(config).run(run).directive('main', function () {
    return {
      templateUrl: '/main/main.html',
      scope: {},
      controllerAs: "$ctrl",
      replace: false,
      controller: controller
    };
  }).directive('userRows', function () {
    return {
      scope: {
        user: '=user'
      },
      controllerAs: "$ctrl",
      replace: true,
      // template: "<div>\n\n</div>",
      templateUrl: '/main/row.html',
      controller: ["$scope", function controller($scope) {
        "ngInject";

        console.log('Row', this, $scope);
        this.user = $scope.user;
      }]
    };
  });

  function config($stateProvider, $urlServiceProvider) {
    "ngInject";

    console.log('configuring users component');

    // setting self as main route
    $urlServiceProvider.rules.otherwise({ state: 'userlist' });

    $stateProvider.state('userlist', {
      url: '/',
      template: "<main></main>"
    });
  }

  function run() {
    "ngInject";

    console.log('running users component');
  }

  function controller(usersStore) {
    var _this = this;

    this.$onDestroy = componentWillUnmount.bind(this);

    this.sortUsers = sortUsers.bind(this);

    this.users = usersStore;

    this.demo = {
      'customer_id': '1',
      'first_name': 'Peter',
      'last_name': 'Smith',
      'birthday': '1996-10-12',
      'gender': 'm',
      'last_contact': '2013-06-01',
      'customer_lifetime_value': '191,12'
    };

    this.$onInit = function () {
      // do some init stuff
      console.log('users component', _this);
    };
  }

  function componentWillUnmount() {}

  function sortUsers() {}
})(angular);

(function (angular) {
  'use strict';

  angular.module('webtrekk').factory('usersStore', usersFactory);

  function usersFactory() {
    "ngInject";

    var initialMaster = { "1": { "customer_id": "1", "first_name": "Peter", "last_name": "Smith", "birthday": "1996-10-12", "gender": "m", "last_contact": "2013-06-01", "customer_lifetime_value": "191,12" }, "2": { "customer_id": "2", "first_name": "Anna", "last_name": "Hopp", "birthday": "1987-05-03", "gender": "w", "last_contact": "2013-07-08", "customer_lifetime_value": "50,99" }, "3": { "customer_id": "3", "first_name": "Christian", "last_name": "Cox", "birthday": "1991-02-21", "gender": "m", "last_contact": "2013-08-01", "customer_lifetime_value": "0" }, "4": { "customer_id": "4", "first_name": "Roxy", "last_name": "Fox", "birthday": "1979-06-30", "gender": "w", "last_contact": "2012-01-29", "customer_lifetime_value": "213,12" }, "5": { "customer_id": "5", "first_name": "Eric", "last_name": "Adam", "birthday": "1969-11-21", "gender": "m", "last_contact": "2013-03-18", "customer_lifetime_value": "1019,91" } };
    var initialNav = [{ "customer_id": "1", "pages": "A", "timestamp": "2013-06-01 10:10:12" }, { "customer_id": "1", "pages": "B", "timestamp": "2013-06-01 10:11:12" }, { "customer_id": "1", "pages": "A", "timestamp": "2013-06-01 10:12:12" }, { "customer_id": "2", "pages": "C", "timestamp": "2013-07-08 09:03:09" }, { "customer_id": "2", "pages": "A", "timestamp": "2013-07-08 09:09:09" }, { "customer_id": "2", "pages": "D", "timestamp": "2013-07-08 09:19:09" }, { "customer_id": "3", "pages": "B", "timestamp": "2013-07-08 09:19:09" }, { "customer_id": "3", "pages": "A", "timestamp": "2013-07-08 09:19:10" }, { "customer_id": "4", "pages": "D", "timestamp": "2013-07-08 09:19:11" }, { "customer_id": "4", "pages": "A", "timestamp": "2013-07-08 09:19:12" }, { "customer_id": "5", "pages": "X", "timestamp": "2013-07-08 09:19:13" }, { "customer_id": "5", "pages": "A", "timestamp": "2013-07-08 09:19:14" }, { "customer_id": "5", "pages": "B", "timestamp": "2013-07-08 09:19:15" }];
    var Users = {};

    Users.method = function () {
      var f = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
      return Object.assign({}, f);
    };
    Users.actions = {};
    Users.values = {
      master: initialMaster,
      nav: initialNav
    };
    Users.store = {};
    return Users;
  }
})(angular);

(function (angular) {
  'use strict';

  angular.module("webtrekk").run(["$templateCache", function ($templateCache) {
    $templateCache.put("/main/row.html", "<tr>\n  <td ng-repeat=\"col in $ctrl.user\">\n    <a>\n      {{ col }}\n    </a>\n  </td>\n  <td>\n      <button ng-click=\"$ctrl.onToggleActive({ userId: $ctrl.user.id })\">\n          {{ $ctrl.user.active ? \"Deactivate\" : \"Activate\" }}\n      </button>\n  </td>\n</tr>");
    $templateCache.put("/main/main.html", "<table>\n  <tr ng-repeat=\"row in $ctrl.users.values.master\">\n      <td ng-repeat=\"col in row\">\n        <a>\n          {{ col }}\n        </a>\n      </td>\n      <td>\n          <button ng-click=\"$ctrl.onToggleActive({ userId: $ctrl.user.id })\">\n              {{ $ctrl.user.active ? \"Deactivate\" : \"Activate\" }}\n          </button>\n      </td>\n    </tr>\n</table>");
  }]);
})(angular);